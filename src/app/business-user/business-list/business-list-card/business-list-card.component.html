<div class="card">
  <section class="card__wrapper">
    <div class="image-box">
      <!-- FEATURED BADGE -->
      <p class="image-box__featured-badge" *ngIf="data.featured">
        FEATURED
      </p>

      <div class="image-box__button image-box__button_desktop" (click)="fileInput.click()">
        <svg width="22" height="19" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
                d="M5.93733 0.00243569C5.74291 0.0255357 5.56918 0.173508 5.51547 0.361766L4.1952 5.00179H0.453116C0.207331 5.02494 -0.00106076 5.25488 4.06281e-06 5.50173V18.5001C3.51128e-05 18.7618 0.238208 19 0.49999 19H16.4995C16.7613 19 16.9995 18.7618 16.9995 18.5001V17.7345L17.8589 17.9767C18.1124 18.0527 18.4123 17.8878 18.4838 17.633L21.9837 4.88462C22.0545 4.63104 21.8864 4.33601 21.6322 4.26751C21.6322 4.26751 11.4092 0.943968 6.13264 0.0180607L6.128 0.0172445C6.06515 0.00619372 6.00105 -0.00507914 5.93733 0.00243569ZM6.35138 1.11167L20.8822 5.09553L17.6479 16.8753L16.9995 16.6956V5.50173C16.9995 5.23997 16.7613 5.00182 16.4995 5.00179H5.23423L6.35138 1.11167ZM15.9995 6.00167H0.999975V14.4381L4.7733 12.5477C4.81751 12.5253 4.86507 12.5093 4.91393 12.5008C5.07951 12.4749 5.25644 12.5389 5.36704 12.6649L7.29667 14.7896L12.2731 12.2977C12.3197 12.2746 12.37 12.2586 12.4215 12.2509C12.5871 12.2249 12.764 12.289 12.8746 12.4149L15.9995 15.9301V6.00167ZM7.99977 8.00141C6.90115 8.00141 5.99983 8.90265 5.99983 10.0011C5.99983 11.0996 6.90116 12.0009 7.99977 12.0009C9.09839 12.0009 9.99972 11.0996 9.99972 10.0011C9.99972 8.90265 9.09839 8.00141 7.99977 8.00141ZM8.99975 10.0011C8.99975 9.44302 8.55796 9.0013 7.99977 9.0013C7.44158 9.0013 6.9998 9.44302 6.9998 10.0011C6.9998 10.5593 7.44158 11.001 7.99977 11.001C8.55796 11.001 8.99975 10.5593 8.99975 10.0011ZM12.3825 13.3679L15.9995 17.4299V18.0001H10.2263L7.99977 15.5551L12.3825 13.3679ZM8.86694 18.0001L4.88268 13.6179L0.999975 15.5629V18.0001H8.86694Z"
                fill="white"/>
        </svg>
        <p class="image-box__text">
          <span>Upload Image</span>
        </p>
      </div>

      <div class="image-box__button image-box__button_low image-box__button_desktop" (click)="seeAllImages()">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="4" height="4" fill="white"/>
          <rect x="6" width="4" height="4" fill="white"/>
          <rect x="12" width="4" height="4" fill="white"/>
          <rect y="6" width="4" height="4" fill="white"/>
          <rect x="6" y="6" width="4" height="4" fill="white"/>
          <rect x="12" y="6" width="4" height="4" fill="white"/>
          <rect y="12" width="4" height="4" fill="white"/>
          <rect x="6" y="12" width="4" height="4" fill="white"/>
          <rect x="12" y="12" width="4" height="4" fill="white"/>
        </svg>
        <p class="image-box__text">
          <span>See all</span>
        </p>
      </div>

      <div class="image-box__button" [ngClass]="{'wide' : !data?.primaryPhoto?.id}" *ngIf="data?.primaryPhoto?.id"
           (click)="seeAllImages()">
        <svg width="22" height="19" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
                d="M5.93733 0.00243569C5.74291 0.0255357 5.56918 0.173508 5.51547 0.361766L4.1952 5.00179H0.453116C0.207331 5.02494 -0.00106076 5.25488 4.06281e-06 5.50173V18.5001C3.51128e-05 18.7618 0.238208 19 0.49999 19H16.4995C16.7613 19 16.9995 18.7618 16.9995 18.5001V17.7345L17.8589 17.9767C18.1124 18.0527 18.4123 17.8878 18.4838 17.633L21.9837 4.88462C22.0545 4.63104 21.8864 4.33601 21.6322 4.26751C21.6322 4.26751 11.4092 0.943968 6.13264 0.0180607L6.128 0.0172445C6.06515 0.00619372 6.00105 -0.00507914 5.93733 0.00243569ZM6.35138 1.11167L20.8822 5.09553L17.6479 16.8753L16.9995 16.6956V5.50173C16.9995 5.23997 16.7613 5.00182 16.4995 5.00179H5.23423L6.35138 1.11167ZM15.9995 6.00167H0.999975V14.4381L4.7733 12.5477C4.81751 12.5253 4.86507 12.5093 4.91393 12.5008C5.07951 12.4749 5.25644 12.5389 5.36704 12.6649L7.29667 14.7896L12.2731 12.2977C12.3197 12.2746 12.37 12.2586 12.4215 12.2509C12.5871 12.2249 12.764 12.289 12.8746 12.4149L15.9995 15.9301V6.00167ZM7.99977 8.00141C6.90115 8.00141 5.99983 8.90265 5.99983 10.0011C5.99983 11.0996 6.90116 12.0009 7.99977 12.0009C9.09839 12.0009 9.99972 11.0996 9.99972 10.0011C9.99972 8.90265 9.09839 8.00141 7.99977 8.00141ZM8.99975 10.0011C8.99975 9.44302 8.55796 9.0013 7.99977 9.0013C7.44158 9.0013 6.9998 9.44302 6.9998 10.0011C6.9998 10.5593 7.44158 11.001 7.99977 11.001C8.55796 11.001 8.99975 10.5593 8.99975 10.0011ZM12.3825 13.3679L15.9995 17.4299V18.0001H10.2263L7.99977 15.5551L12.3825 13.3679ZM8.86694 18.0001L4.88268 13.6179L0.999975 15.5629V18.0001H8.86694Z"
                fill="white"/>
        </svg>
        <p class="image-box__text">
          <span>See all</span>
        </p>
      </div>
      <div class="image-box__button" [ngClass]="{'wide' : !data?.primaryPhoto?.id}" *ngIf="!data?.primaryPhoto?.id"
           (click)="fileInput.click()">
        <svg width="22" height="19" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
                d="M5.93733 0.00243569C5.74291 0.0255357 5.56918 0.173508 5.51547 0.361766L4.1952 5.00179H0.453116C0.207331 5.02494 -0.00106076 5.25488 4.06281e-06 5.50173V18.5001C3.51128e-05 18.7618 0.238208 19 0.49999 19H16.4995C16.7613 19 16.9995 18.7618 16.9995 18.5001V17.7345L17.8589 17.9767C18.1124 18.0527 18.4123 17.8878 18.4838 17.633L21.9837 4.88462C22.0545 4.63104 21.8864 4.33601 21.6322 4.26751C21.6322 4.26751 11.4092 0.943968 6.13264 0.0180607L6.128 0.0172445C6.06515 0.00619372 6.00105 -0.00507914 5.93733 0.00243569ZM6.35138 1.11167L20.8822 5.09553L17.6479 16.8753L16.9995 16.6956V5.50173C16.9995 5.23997 16.7613 5.00182 16.4995 5.00179H5.23423L6.35138 1.11167ZM15.9995 6.00167H0.999975V14.4381L4.7733 12.5477C4.81751 12.5253 4.86507 12.5093 4.91393 12.5008C5.07951 12.4749 5.25644 12.5389 5.36704 12.6649L7.29667 14.7896L12.2731 12.2977C12.3197 12.2746 12.37 12.2586 12.4215 12.2509C12.5871 12.2249 12.764 12.289 12.8746 12.4149L15.9995 15.9301V6.00167ZM7.99977 8.00141C6.90115 8.00141 5.99983 8.90265 5.99983 10.0011C5.99983 11.0996 6.90116 12.0009 7.99977 12.0009C9.09839 12.0009 9.99972 11.0996 9.99972 10.0011C9.99972 8.90265 9.09839 8.00141 7.99977 8.00141ZM8.99975 10.0011C8.99975 9.44302 8.55796 9.0013 7.99977 9.0013C7.44158 9.0013 6.9998 9.44302 6.9998 10.0011C6.9998 10.5593 7.44158 11.001 7.99977 11.001C8.55796 11.001 8.99975 10.5593 8.99975 10.0011ZM12.3825 13.3679L15.9995 17.4299V18.0001H10.2263L7.99977 15.5551L12.3825 13.3679ZM8.86694 18.0001L4.88268 13.6179L0.999975 15.5629V18.0001H8.86694Z"
                fill="white"/>
        </svg>
        <p class="image-box__text">
          <span>Upload Image</span>
        </p>
      </div>

      <ngx-ui-loader [overlayColor]="'#fff'" [fgsColor]="'#823cf1'" [loaderId]="'upload-picture-on-card' + data.id"
                     [fgsType]="'wandering-cubes'" [hasProgressBar]="false"></ngx-ui-loader>

      <input
        [multiple]="false"
        #fileInput
        type="file"
        accept="image/*"
        id="cameraInput"
        name="cameraInput"
        style="display: none"
        (change)="onFileSelected($event)">

      <img *ngIf="data?.primaryPhoto?.id"
           (click)="seeAllImages()"
           [src]="data?.primaryPhoto?.url"
           alt="Business Image"
           class="image-box__image">
      <img *ngIf="!data?.primaryPhoto?.id" (click)="seeAllImages()"
           [src]="BUSINESS_IMAGE_URI"
           alt="Business Image"
           class="image-box__image">

      <p class="image-box__edit-button" [routerLink]="[data.id]">
        Edit Business Info
      </p>
    </div>

    <!-- BLOCK WITH INFO -->
    <div class="card-info">

      <div class="title-block">

        <!-- FEATURED BADGE -->
        <p class="title-block__featured-badge" *ngIf="data.featured">
          FEATURED
        </p>
        <div class="title-block__wrapper">
          <p class="title-block__name">
            {{data?.name}}
          </p>

          <p class="title-block__city" *ngIf="data?.city">
            {{data?.city}}, {{data?.state | shortenState}}
          </p>

          <div class="title-block__stats-box">
            <p class="title-block__rate">
              <img src="../../../../assets/images/icons/star-icon_purple.svg" alt="">
              {{data?.rating ? (data?.rating | number:'1.1-1') : '-'}}
            </p>
            <p class="title-block__rate">
              <img src="../../../../assets/images/icons/checkin-icon.svg" alt="">
              {{data?.checkInsCount}} Check-ins
            </p>
          </div>

          <p class="title-block__category">
            <i class="pi pi-tag"></i>
            <span class="item" *ngFor="let item of data?.businessTypes; let i = index">
            {{item.code}}

              <i *ngIf="data?.businessTypes.length > 1 && i < data?.businessTypes.length - 1">,</i>
          </span>
          </p>
        </div>
      </div>

      <div class="card-info__wrapper">
        <a *ngIf="data?.phone" href="tel:{{data?.phone | phoneNumberForCall:(phoneInfo$ | async)}}"
           class="card-info__item">
          <img src="../../../../assets/images/icons/phone-icon_gray.svg" alt="" class="card-info__icon">
          <p class="card-info__text card-info__text_black">
            {{data?.phone | phoneNumber:(phoneInfo$ | async)}}
          </p>
        </a>
        <a *ngIf="data?.website" (click)="openWebSite(data?.website)" class="card-info__item">
          <img src="../../../../assets/images/icons/external-icon.svg" alt="" class="card-info__icon">
          <p class="card-info__text">
            {{data?.website}}
          </p>
        </a>
        <a *ngIf="data?.email" href="mailto:{{data?.email}}" target="_blank" class="card-info__item">
          <img src="../../../../assets/images/icons/mail-icon.svg" alt="" class="card-info__icon">
          <p class="card-info__text">
            {{data?.email}}
          </p>
        </a>
      </div>
    </div>
  </section>

  <!-- UPGRADE BLOCK -->
  <div *ngIf="!data.memberAt" class="upgrade">
    <img src="../../../../assets/images/icons/upgrade-image.svg"
         alt="Upgrade image"
         class="upgrade__image">
    <p class="upgrade__text">
      <i class="upgrade__text-heading">Make your business stand out</i>
      <br>
      <i>Add deals, events, specials to your business</i>
    </p>

    <p class="upgrade__button" (click)="upgradeBusiness()">
      Upgrade
    </p>
  </div>

  <!-- SETTINGS BUTTONS BLOCK -->
  <div *ngIf="data.memberAt" class="manage">
    <div class="manage__wrapper">
      <div class="manage__text-box">
        <p class="manage__title">
          Manage My page
        </p>
        <p class="manage__text">
          Use Kidazzler features to attract new customers to your business.

          <i class="manage__additional-text">
            View your plan
          </i>
        </p>
      </div>
      <div class="button-block">

        <div class="button-block__item" [routerLink]="['../businesses', data.id, 'deals']">
          <div class="button-block__image-block">
            <!-- BADGE WITH NOTIFICATIONS NUMBER -->
            <span *ngIf="hasDealsNotifications" class="button-block__counter">2</span>
            <img src="../../../../assets/images/icons/promotion-icon.svg" alt="Deals" class="button-block__icon">
          </div>
          <p class="button-block__text">Deals</p>
          <span class="badge">{{data?.dealsCount || 0}}</span>
        </div>

        <div class="button-block__item" [routerLink]="['../businesses', data.id, 'events']">
          <div class="button-block__image-block">
            <!-- BADGE WITH NOTIFICATIONS NUMBER -->
            <span *ngIf="hasEventsNotifications" class="button-block__counter">2</span>
            <img src="../../../../assets/images/icons/calendar-icon.svg" alt="Events" class="button-block__icon">
          </div>
          <p class="button-block__text">Events</p>
          <span class="badge">{{data?.eventsCount || 0}}</span>
        </div>

        <div class="button-block__item" (click)="checkinCode()">
          <div class="button-block__image-block">
            <img src="../../../../assets/images/icons/checked-in-icon.svg" alt="Check-in Code"
                 class="button-block__icon">
          </div>
          <p class="button-block__text">Check-in Code</p>
        </div>

        <div class="button-block__item disabled-btn" [routerLink]="['../businesses', data.id, 'wall']">
          <div class="button-block__image-block">
            <img src="../../../../assets/images/icons/home-icon.svg" alt="" class="button-block__icon">
          </div>
          <p class="button-block__text">Wall</p>
        </div>
      </div>
    </div>
  </div>

  <p class="card__button" [routerLink]="[data.id]">
    Edit Business Info
  </p>
</div>

<p-dialog *ngIf="isCheckInDialogOpened"
          [visible]="true"
          [modal]="true"
          [dismissableMask]="true"
          [styleClass]="'custom-popup checking-code'"
          [closable]="false"
          [draggable]="false"
          [resizable]="false"
          [showHeader]="false"
          (onHide)="isCheckInDialogOpened=false"
          breakpoint="360"
>
  <div class="close" (click)="isCheckInDialogOpened=false"></div>
  <div class="popup-title">
    <div>Your Check-In Code</div>
  </div>
  <div class="popup-content group-popup-content">
    <kz-checkin-code
      [code]="data.checkInCode"
      [count]="data.checkInsCount"
      [createdAt]="data.checkInCodeGeneratedAt"
      [businessId]="data.id"
      [isMobile]="isMobile"
      (checkinCodeClose)="onCheckinCodeClose($event)"
    ></kz-checkin-code>
  </div>
</p-dialog>

<!-- BEGIN: MODAL WITH REWARDS INFO -->
<p-dialog
  *ngIf="isEditCheckInDialogOpened"
  [visible]="true"
  [modal]="true"
  [dismissableMask]="true"
  [styleClass]="'custom-popup checking-code edit'"
  [closable]="false"
  [draggable]="false"
  [resizable]="false"
  [showHeader]="false"
  (onHide)="isEditCheckInDialogOpened=false"
  breakpoint="360"
>

  <kz-edit-checkin-code
    [code]="data.checkInCode"
    [count]="data.checkInsCount"
    [createdAt]="data.checkInCodeGeneratedAt"
    [businessId]="data.id"
    [isMobile]="false"
    (closeEditCode)="onCloseEditCode($event)"
  ></kz-edit-checkin-code>
</p-dialog>
<!-- END: MODAL WITH REWARDS INFO -->
